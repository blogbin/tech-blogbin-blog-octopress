<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tech.Blogbin's Blog]]></title>
  <link href="http://tech-blog.blogbin.info/atom.xml" rel="self"/>
  <link href="http://tech-blog.blogbin.info/"/>
  <updated>2012-10-06T17:24:52+08:00</updated>
  <id>http://tech-blog.blogbin.info/</id>
  <author>
    <name><![CDATA[Tech Blogbin ]]></name>
    <email><![CDATA[Tech Blogbin <tech.blogbin@gmail.com>]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails Recipes Rails 3 Edition Recipe 2 Create Declarative Named Queries]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/10/06/rails-recipes-rails-3-edition-recipe-2-create-declarative-named-queries/"/>
    <updated>2012-10-06T17:12:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/10/06/rails-recipes-rails-3-edition-recipe-2-create-declarative-named-queries</id>
    <content type="html"><![CDATA[<p>ActiveRecord Scope 是定义查询相关类方法的一种快捷方式。</p>

<p>以下代码，模型查询或业务逻辑代码暴露在 controller</p>

<blockquote><p><figure class='code'><figcaption><span>rr2/declarative_scopes/app/controllers/wombats_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/><span class='line-number'>5</span><br/><span class='line-number'>6</span><br/><span class='line-number'>7</span><br/></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">WombatsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span><br/></span><span class='line'>  <span class="k">def</span> <span class="nf">search</span><br/></span><span class='line'>        <span class="vi">@wombats</span> <span class="o">=</span> <span class="no">Wombat</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;bio like ?&quot;</span><span class="p">,</span> <span class="s2">&quot;%</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:q</span><span class="o">]</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span><span class="o">.</span><br/></span><span class='line'>      <span class="n">order</span><span class="p">(</span><span class="ss">:age</span><span class="p">)</span><br/></span><span class='line'>     <span class="n">render</span> <span class="ss">:index</span><br/></span><span class='line'> <span class="k">end</span><br/></span><span class='line'><span class="k">end</span><br/></span></code></pre></td></tr></table></div></figure></p></blockquote>


<p>重构将模型查询或业务逻辑代码封装在 model 类中，如：</p>

<!--more-->


<blockquote><p><figure class='code'><figcaption><span>rr2/declarative_scopes/app/controllers/wombats_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">search</span><br/></span><span class='line'>  <span class="vi">@wombats</span> <span class="o">=</span> <span class="no">Wombat</span><span class="o">.</span><span class="n">with_bio_containing</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:q</span><span class="o">]</span><span class="p">)</span><br/></span><span class='line'>    <span class="n">render</span> <span class="ss">:index</span><br/></span><span class='line'><span class="k">end</span><br/></span></code></pre></td></tr></table></div></figure></p><p><figure class='code'><figcaption><span>rr2/declarative_scopes/app/models/wombat.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/><span class='line-number'>5</span><br/><span class='line-number'>6</span><br/></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Wombat</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><br/></span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">with_bio_containing</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><br/></span><span class='line'>       <span class="n">where</span><span class="p">(</span><span class="s2">&quot;bio like ?&quot;</span><span class="p">,</span> <span class="s2">&quot;%</span><span class="si">#{</span><span class="n">query</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span><span class="o">.</span><br/></span><span class='line'>     <span class="n">order</span><span class="p">(</span><span class="ss">:age</span><span class="p">)</span><br/></span><span class='line'> <span class="k">end</span><br/></span><span class='line'><span class="k">end</span><br/></span></code></pre></td></tr></table></div></figure></p></blockquote>


<p>改用 scope 来定义与查询相关的方法，如</p>

<blockquote><p><figure class='code'><figcaption><span>rr2/declarative_scopes/app/models/wombat.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Wombat</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><br/></span><span class='line'>   <span class="n">scope</span> <span class="ss">:with_bio_containing</span><span class="p">,</span> <span class="nb">lambda</span> <span class="p">{</span><span class="o">|</span><span class="n">query</span><span class="o">|</span> <span class="n">where</span><span class="p">(</span><span class="s2">&quot;bio like ?&quot;</span><span class="p">,</span> <span class="s2">&quot;%</span><span class="si">#{</span><span class="n">query</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span><span class="o">.</span><br/></span><span class='line'>   <span class="n">order</span><span class="p">(</span><span class="ss">:age</span><span class="p">)</span> <span class="p">}</span><br/></span><span class='line'><span class="k">end</span><br/></span></code></pre></td></tr></table></div></figure></p></blockquote>


<p>scope 方法返回 ActiveRecord::Relation，采用延迟加载的方式。</p>

<blockquote><p>You see here that a call to our teenagers() scope actually returns an instance<br/>of ActiveRecord::Relation, not an Array of Person objects! We can ask an ActiveRecord::Relation<br/>to convert itself to SQL with the to_sql() method. If we combine two scopes,<br/>you see that the ActiveRecord::Relation objects actually combine to generate one<br/>composed query.</p></blockquote>


<p>更多 ActiveRecord Scope 信息参见：
<a href="http://guides.rubyonrails.org/active_record_querying.html#scopes">http://guides.rubyonrails.org/active_record_querying.html#scopes</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[guides.rubyonrails.org association_basics]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/10/04/guides-dot-rubyonrails-dot-org-association-basics/"/>
    <updated>2012-10-04T10:34:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/10/04/guides-dot-rubyonrails-dot-org-association-basics</id>
    <content type="html"><![CDATA[<h4>association_basics</h4>

<p>学习 Rails ActiveRecord 中 has_many 的 :through, :as, source, :inverse_of 等几个参数的用法</p>

<!--more-->


<p>has_many 的 :through 可以快速获得嵌套 has_many 的对象。如：</p>

<blockquote><p>The has_many :through association is also useful for setting up “shortcuts” through nested has_many associations. For example, if a document has many sections, and a section has many paragraphs, you may sometimes want to get a simple collection of all paragraphs in the document. You could set that up this way:<br/><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/><span class='line-number'>5</span><br/><span class='line-number'>6</span><br/><span class='line-number'>7</span><br/><span class='line-number'>8</span><br/><span class='line-number'>9</span><br/><span class='line-number'>10</span><br/><span class='line-number'>11</span><br/><span class='line-number'>12</span><br/><span class='line-number'>13</span><br/></pre></td><td class='code'><pre><code class=''><span class='line'>class Document &lt; ActiveRecord::Base<br/></span><span class='line'>  has_many :sections<br/></span><span class='line'>  has_many :paragraphs, :through =&gt; :sections<br/></span><span class='line'>end<br/></span><span class='line'> <br/></span><span class='line'>class Section &lt; ActiveRecord::Base<br/></span><span class='line'>  belongs_to :document<br/></span><span class='line'>  has_many :paragraphs<br/></span><span class='line'>end<br/></span><span class='line'> <br/></span><span class='line'>class Paragraph &lt; ActiveRecord::Base<br/></span><span class='line'>  belongs_to :section<br/></span><span class='line'>end</span></code></pre></td></tr></table></div></figure><br/>With :through => :sections specified, Rails will now understand:<br/><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/></pre></td><td class='code'><pre><code class=''><span class='line'>@document.paragraphs</span></code></pre></td></tr></table></div></figure></p></blockquote>


<p>但如何直接赋值似乎成为一个问题，如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@document.paragraphs = paragraphs</span></code></pre></td></tr></table></div></figure>


<h4>泛型关联</h4>

<p>polymorphic-associations</p>

<blockquote><p>2.9 Polymorphic Associations<br/>A slightly more advanced twist on associations is the polymorphic association. With polymorphic associations, a model can belong to more than one other model, on a single association. For example, you might have a picture model that belongs to either an employee model or a product model. Here’s how this could be declared:<br/><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/><span class='line-number'>5</span><br/><span class='line-number'>6</span><br/><span class='line-number'>7</span><br/><span class='line-number'>8</span><br/><span class='line-number'>9</span><br/><span class='line-number'>10</span><br/><span class='line-number'>11</span><br/></pre></td><td class='code'><pre><code class=''><span class='line'>class Picture &lt; ActiveRecord::Base<br/></span><span class='line'>  belongs_to :imageable, :polymorphic =&gt; true<br/></span><span class='line'>end<br/></span><span class='line'> <br/></span><span class='line'>class Employee &lt; ActiveRecord::Base<br/></span><span class='line'>  has_many :pictures, :as =&gt; :imageable<br/></span><span class='line'>end<br/></span><span class='line'> <br/></span><span class='line'>class Product &lt; ActiveRecord::Base<br/></span><span class='line'>  has_many :pictures, :as =&gt; :imageable<br/></span><span class='line'>end</span></code></pre></td></tr></table></div></figure></p></blockquote>


<p>注意 Picture 的 :belong_to 和 Employee 以及 Product 的 :as 保持一致，都是 :imageable</p>

<blockquote><p>From an instance of the Employee model, you can retrieve a collection of pictures: @employee.pictures.</p><p>Similarly, you can retrieve @product.pictures.</p><p>If you have an instance of the Picture model, you can get to its parent via @picture.imageable. To make this work, you need to declare both a foreign key column and a type column in the model that declares the polymorphic interface:<br/><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/><span class='line-number'>5</span><br/><span class='line-number'>6</span><br/><span class='line-number'>7</span><br/><span class='line-number'>8</span><br/><span class='line-number'>9</span><br/><span class='line-number'>10</span><br/></pre></td><td class='code'><pre><code class=''><span class='line'>class CreatePictures &lt; ActiveRecord::Migration<br/></span><span class='line'>  def change<br/></span><span class='line'>    create_table :pictures do |t|<br/></span><span class='line'>      t.string  :name<br/></span><span class='line'>      t.integer :imageable_id<br/></span><span class='line'>      t.string  :imageable_type<br/></span><span class='line'>      t.timestamps<br/></span><span class='line'>    end<br/></span><span class='line'>  end<br/></span><span class='line'>end</span></code></pre></td></tr></table></div></figure><br/>This migration can be simplified by using the t.references form:<br/><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/><span class='line-number'>5</span><br/><span class='line-number'>6</span><br/><span class='line-number'>7</span><br/><span class='line-number'>8</span><br/><span class='line-number'>9</span><br/></pre></td><td class='code'><pre><code class=''><span class='line'>class CreatePictures &lt; ActiveRecord::Migration<br/></span><span class='line'>  def change<br/></span><span class='line'>    create_table :pictures do |t|<br/></span><span class='line'>      t.string :name<br/></span><span class='line'>      t.references :imageable, :polymorphic =&gt; true<br/></span><span class='line'>      t.timestamps<br/></span><span class='line'>    end<br/></span><span class='line'>  end<br/></span><span class='line'>end</span></code></pre></td></tr></table></div></figure></p></blockquote>


<p>被关联的数据表（如 pictures）需要定义 xxx_id, xxx_type 两个字段（如 imageable_id, imageable_type )</p>

<p><a href="http://guides.rubyonrails.org/association_basics.html#polymorphic-associations">http://guides.rubyonrails.org/association_basics.html#polymorphic-associations</a></p>

<h4>has_many 的 :inverse_of 用法</h4>

<blockquote><p>拿最简单的one-one来举例子吧：<br/>User has_one Account<br/>Account belongs_to User<br/>在未设置:inverse_of的情况下：<br/><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/><span class='line-number'>5</span><br/><span class='line-number'>6</span><br/><span class='line-number'>7</span><br/><span class='line-number'>8</span><br/></pre></td><td class='code'><pre><code class=''><span class='line'>u = User.first<br/></span><span class='line'>[2] pry(main)&gt; account = u.account<br/></span><span class='line'>  Account Load (0.5ms)  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 2 LIMIT 1<br/></span><span class='line'>[3] pry(main)&gt; account.user<br/></span><span class='line'>  User Load (0.6ms)  SELECT `users`.* FROM `users` WHERE `users`.`id` = 3 LIMIT 1<br/></span><span class='line'> ```<br/></span><span class='line'><br/></span><span class='line'>设置了inverse_of 以后：</span></code></pre></td></tr></table></div></figure><br/>class User < ActiveRecord::Base<br/>  has_one :account, :inverse_of => :user<br/>end<br/>[1] pry(main)> u = User.first<br/>  User Load (0.3ms)  SELECT `users`.* FROM `users` LIMIT 1<br/>[2] pry(main)> account = u.account<br/>  Account Load (0.1ms)  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`user_id` = 3 LIMIT 1<br/>[3] pry(main)> account.user # No SQL Query<br/>&#8220;`<br/>其中，把user.accout这一方法看成函数就是account(a_user) -> a_account<br/>对应的反函数是user(a_account) 一定返回a_user</p></blockquote>


<p>参阅：
<a href="http://ruby-china.org/topics/5375">http://ruby-china.org/topics/5375</a></p>

<h4>更多关于 has_many 等信息参阅：</h4>

<p>[http://guides.rubyonrails.org/association_basics.html#the-has_many-association](http://guides.rubyonrails.org/association_basics.html#the-has_many-association</p>

<p><a href="http://guides.rubyonrails.org/association_basics.html#the-has_many-through-association">http://guides.rubyonrails.org/association_basics.html#the-has_many-through-association</a></p>

<p><a href="http://guides.rubyonrails.org/association_basics.html#has_many-association-reference">http://guides.rubyonrails.org/association_basics.html#has_many-association-reference</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails Recipes Rails 3 Edition Recipe 1 Create Meaningful Many-to-Many Relationships]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/10/03/rails-recipes-rails-3-edition-recipe-1-create-meaningful-many-to-many-relationships/"/>
    <updated>2012-10-03T23:50:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/10/03/rails-recipes-rails-3-edition-recipe-1-create-meaningful-many-to-many-relationships</id>
    <content type="html"><![CDATA[<h4>关联模型</h4>

<p>Rails 中 ActiveRecord 两个模型之间的多对多关系很少简单用 has_and_belong_to_many 来表示，而是引入第三个模型（关联模型），将之前 A 和 B 的多对多关系，拆分为 A 和 C 的一对多，
B 和 C 的一对多。引入新的关联模型 C ，很容易在 A 和 B 关系上定义一些属性。</p>

<!--more-->




<blockquote><p>When modeling many-to-many relationships in Rails, many newcomers<br/>assume they should use the has_and_belongs_to_many() (habtm) macro with its<br/>associated join table. For years, application developers have been creating<br/>strangely named join tables in order to simply connect two tables. But habtm<br/>is best suited to relationships that have no attributes or meaning of their own.<br/>And, given some thought, almost every relationship in a Rails model deserves<br/>its own name to represent its function in the domain being modeled.</p><p>The idea with join models is that if your many-to-many relationship needs to have some richness<br/>in the association, instead of putting a simple, dumb join table in the middle<br/>of the relationship,</p></blockquote>


<p>migrate 创建 关联表（just simply connect two tables） 可以不需要定义 id 主键</p>

<figure class='code'><figcaption><span>rr2/many_to_many/beginning_schema.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:magazines_readers</span><span class="p">,</span> <span class="ss">:id</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:magazine_id</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">integer</span> <span class="ss">:reader_id</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>参阅：</p>

<blockquote><p>By default, create_table will create a primary key called id. You can change the name of the primary key with the :primary_key option (don’t forget to update the corresponding model) or, if you don’t want a primary key at all (for example for a HABTM join table), you can pass the option :id => false. If you need to pass database specific options you can place an SQL fragment in the :options option. For example,</p><p>create_table :products, :options => &#8220;ENGINE=BLACKHOLE&#8221; do |t|<br/>  t.string :name, :null => false<br/>end<br/>will append ENGINE=BLACKHOLE to the SQL statement used to create the table (when using MySQL, the default is ENGINE=InnoDB).</p></blockquote>


<p><a href="http://guides.rubyonrails.org/migrations.html#creating-a-table">http://guides.rubyonrails.org/migrations.html#creating-a-table</a></p>

<h4>多个 has_many</h4>

<p>一个 Association 可以根据需要定义不同的 has_many，如：</p>

<figure class='code'><figcaption><span>ManyToManyWithAttributesOnTheRelationship/app/models/magazine.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Magazine</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:subscriptions</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:readers</span><span class="p">,</span> <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="ss">:subscriptions</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:semiannual_subscribers</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="ss">:subscriptions</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="ss">:reader</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;length_in_issues = 6&#39;</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h4>has_many 中 :calss 和 :source 的区别</h4>

<p>无法通过 has_many 的一个参数自动推断出 Rails ActiveRecord 模型名称时，如果 has_many 如果使用 :through ，需要设置 :source 参数，否者使用 :calss_name 参数。</p>

<blockquote><p><figure class='code'><figcaption><span>ManyToManyWithAttributesOnTheRelationship/app/models/magazine.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span><br/><span class='line-number'>2</span><br/><span class='line-number'>3</span><br/><span class='line-number'>4</span><br/><span class='line-number'>5</span><br/><span class='line-number'>6</span><br/><span class='line-number'>7</span><br/><span class='line-number'>8</span><br/><span class='line-number'>9</span><br/><span class='line-number'>10</span><br/><span class='line-number'>11</span><br/><span class='line-number'>12</span><br/><span class='line-number'>13</span><br/><span class='line-number'>14</span><br/><span class='line-number'>15</span><br/><span class='line-number'>16</span><br/><span class='line-number'>17</span><br/></pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Relationship</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><br/></span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:user</span><span class="p">,</span><br/></span><span class='line'>    <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><br/></span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:buddy</span><span class="p">,</span><br/></span><span class='line'>    <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;buddy_id&#39;</span><br/></span><span class='line'><span class="k">end</span><br/></span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><br/></span><span class='line'>  <span class="n">has_many</span> <span class="ss">:relations_to</span><span class="p">,</span><br/></span><span class='line'>    <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span>  <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Relationship&#39;</span><br/></span><span class='line'>  <span class="n">has_many</span> <span class="ss">:relations_from</span><span class="p">,</span><br/></span><span class='line'>    <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="s1">&#39;buddy_id&#39;</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Relationship&#39;</span><br/></span><span class='line'><br/></span><span class='line'>  <span class="n">has_many</span> <span class="ss">:linked_to</span><span class="p">,</span><br/></span><span class='line'>    <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="ss">:relations_to</span><span class="p">,</span>   <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="ss">:buddy</span><br/></span><span class='line'>  <span class="n">has_many</span> <span class="ss">:linked_from</span><span class="p">,</span><br/></span><span class='line'>    <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="ss">:relations_from</span><span class="p">,</span> <span class="ss">:source</span> <span class="o">=&gt;</span> <span class="ss">:user</span><br/></span><span class='line'><span class="k">end</span><br/></span></code></pre></td></tr></table></div></figure></p></blockquote>


<p>参阅：</p>

<p><a href="http://stackoverflow.com/questions/4632408/need-help-to-understand-source-option-of-has-one-has-many-through-of-rails">http://stackoverflow.com/questions/4632408/need-help-to-understand-source-option-of-has-one-has-many-through-of-rails</a></p>

<p><a href="http://hlee.iteye.com/blog/1254723">http://hlee.iteye.com/blog/1254723</a></p>

<h4>更多关于 has_many 和 :through 信息参阅：</h4>

<p>[http://guides.rubyonrails.org/association_basics.html#the-has_many-association](http://guides.rubyonrails.org/association_basics.html#the-has_many-association</p>

<p><a href="http://guides.rubyonrails.org/association_basics.html#the-has_many-through-association">http://guides.rubyonrails.org/association_basics.html#the-has_many-through-association</a></p>

<p><a href="http://guides.rubyonrails.org/association_basics.html#has_many-association-reference">http://guides.rubyonrails.org/association_basics.html#has_many-association-reference</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using multiple SSH keys]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/09/16/using-multiple-ssh-keys/"/>
    <updated>2012-09-16T08:51:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/09/16/using-multiple-ssh-keys</id>
    <content type="html"><![CDATA[<p>本地有很多 Git 仓库，需要分别提交不同的远程仓库，甚至同一个本地仓库，需要推送到多个不同远程仓库。所有远程仓库公用一个公钥，和公用相同密码一样存在安全隐患。</p>

<p>需要寻求使用多个 SSH Keys 访问远程仓库的解决方案。
参考；</p>

<p><a href="http://4simple.github.com/docs/multipleSSHkeys/">http://4simple.github.com/docs/multipleSSHkeys/</a></p>

<p><a href="http://www.worldhello.net/2010/01/17/280.html">http://www.worldhello.net/2010/01/17/280.html</a></p>

<p><a href="http://www.xwuxin.com/?p=1994">http://www.xwuxin.com/?p=1994</a></p>

<p>已推送到 GitCafe 为例，先创建 SSH key。
注意不要覆盖已有的 id_rsa，建议按 ~/.ssh/<vendor>/<account>/id_rsa 分目录管理 id_rsa</p>

<p>例如： /Users/blogbin/.ssh/gitcafe/tech.blogbin/id_rsa</p>

<!--more-->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ ssh-keygen -t rsa -C "tech.blogbin@gmail.com"
</span><span class='line'>Generating public/private rsa key pair.
</span><span class='line'>Enter file in which to save the key (/Users/blogbin/.ssh/id_rsa): /Users/blogbin/.ssh/gitcafe/tech.blogbin/id_rsa
</span><span class='line'>Enter passphrase (empty for no passphrase):
</span><span class='line'>Enter same passphrase again:
</span><span class='line'>Your identification has been saved in /Users/blogbin/.ssh/gitcafe/tech.blogbin/id_rsa.
</span><span class='line'>Your public key has been saved in /Users/blogbin/.ssh/gitcafe/tech.blogbin/id_rsa.pub.
</span><span class='line'>The key fingerprint is:
</span><span class='line'>38:77:b7:01:2f:3c:e9:83:03:9e:e9:40:95:e9:b2:52 tech.blogbin@gmail.com
</span><span class='line'>The key's randomart image is:
</span><span class='line'>+--[ RSA 2048]----+
</span><span class='line'>|                 |
</span><span class='line'>|       o         |
</span><span class='line'>|      +   .      |
</span><span class='line'>|     o . . +     |
</span><span class='line'>|    E = S * +    |
</span><span class='line'>|   o + * + + o   |
</span><span class='line'>|  . o + o o .    |
</span><span class='line'>|   . o   . .     |
</span><span class='line'>|      .          |
</span><span class='line'>+-----------------+</span></code></pre></td></tr></table></div></figure>


<p>配置 ~/.ssh/config 映射不同的主机使用不同的 SSH Key</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ cat ~/.ssh/config
</span><span class='line'>Host heroku.com
</span><span class='line'>  HostName heroku.com
</span><span class='line'>  User tech.blogbin@gmail.com
</span><span class='line'>  IdentityFile ~/.ssh/github_rsa.pub
</span><span class='line'>
</span><span class='line'>Host gitcafe.com
</span><span class='line'>  User tech.blogbin@gmail.com
</span><span class='line'>  Hostname gitcafe.com
</span><span class='line'>  PreferredAuthentications publickey
</span><span class='line'>  IdentityFile ~/.ssh/gitcafe/tech.blogbin/id_rsa</span></code></pre></td></tr></table></div></figure>


<p>将新创建的 id_rsa 内容提交在远程 git 仓库的 SSH Public Keys 中管理</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ cat  /Users/blogbin/.ssh/gitcafe/tech.blogbin/id_rsa.pub
</span><span class='line'>
</span><span class='line'>... 以下省略 ...</span></code></pre></td></tr></table></div></figure>


<p>推送到远程 git 仓库，以 GitCafe 为例：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ git remote add gitcafe git@gitcafe.com:blogbin/tech-blogbin-blog-octopress.git
</span><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ git push -u gitcafe master
</span><span class='line'>The authenticity of host 'gitcafe.com (50.116.2.223)' can't be established.
</span><span class='line'>RSA key fingerprint is 84:9e:c9:8e:7f:36:28:08:7e:13:bf:43:12:74:11:4e.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added 'gitcafe.com,50.116.2.223' (RSA) to the list of known hosts.
</span><span class='line'>Identity added: /Users/blogbin/.ssh/gitcafe/tech.blogbin/id_rsa (/Users/blogbin/.ssh/gitcafe/tech.blogbin/id_rsa)
</span><span class='line'>Counting objects: 13098, done.
</span><span class='line'>Delta compression using up to 2 threads.
</span><span class='line'>Compressing objects: 100% (6032/6032), done.
</span><span class='line'>Writing objects: 100% (13098/13098), 5.51 MiB | 52 KiB/s, done.
</span><span class='line'>Total 13098 (delta 7409), reused 9883 (delta 5632)
</span><span class='line'>To git@gitcafe.com:blogbin/tech-blogbin-blog-octopress.git
</span><span class='line'> * [new branch]      master -&gt; master
</span><span class='line'>Branch master set up to track remote branch master from gitcafe. </span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using GitCafe]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/09/16/using-gitcafe/"/>
    <updated>2012-09-16T08:36:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/09/16/using-gitcafe</id>
    <content type="html"><![CDATA[<p>试用了 GitCafe <a href="http://www.gitcafe.com/">http://www.gitcafe.com/</a>，</p>

<p>国内的 Git 仓库管理系统。功能和 Bitbucket <a href="https://bitbucket.org/">https://bitbucket.org/</a></p>

<p>可以作为 GitHub, Heroku, Bitbucket 之后，另外一个 Git 远程仓库。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Could not find gem 'rails (= 3.2.8) ruby' in the gems available on this machine.]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/09/15/could-not-find-gem-rails-equals-3-dot-2-8-ruby-in-the-gems-available-on-this-machine/"/>
    <updated>2012-09-15T22:47:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/09/15/could-not-find-gem-rails-equals-3-dot-2-8-ruby-in-the-gems-available-on-this-machine</id>
    <content type="html"><![CDATA[<p>之前 Rails 项目的 Rails 版本升级到 3.2.8。在 Centos 6.x 和 MacOS 都比较顺利。</p>

<p>但有同事反馈 Ubuntu 12.x + RVM + Gemset 方式无法遇到麻烦，不管是执行 bundle install or gem install</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>liwy@ubuntu:~/.rvm/gems/ruby-1.9.3-p125/cache$ bundle install
</span><span class='line'>Could not find gem 'rails (= 3.2.8) ruby' in the gems available on this machine.
</span><span class='line'>
</span><span class='line'>liwy@ubuntu:~/.rvm/gems/ruby-1.9.3-p125/cache$ gem install rails -v 3.2.8 
</span><span class='line'>Could not find gem 'rails (= 3.2.8) ruby' in the gems available on this machine.</span></code></pre></td></tr></table></div></figure>


<p>后来同事反馈，删除掉 rvm cache 的 <em>specs</em>.gz 相关的文件，重新执行 bundle install or gem install 成功</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>liwy@ubuntu:~/.rvm/gems/ruby-1.9.3-p125/cache$ rm -rf latest_specs.4.8.gz
</span><span class='line'>
</span><span class='line'>liwy@ubuntu:~/.rvm/gems/ruby-1.9.3-p125/cache$ rm -rf specs.4.8.gz</span></code></pre></td></tr></table></div></figure>


<p>怀疑是网络原因，造成下载的 gz 不完整，删掉重新下载，应该可以解决类似问题。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Resolving error: .css.scss has already been required]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/09/13/resolving-error-css-dot-scss-has-already-been-required/"/>
    <updated>2012-09-13T00:01:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/09/13/resolving-error-css-dot-scss-has-already-been-required</id>
    <content type="html"><![CDATA[<p>浏览器访问 Rails 的 Web 界面时，界面提示 app/assets/stylesheets/application.css.scss 出错</p>

<p>.css.scss has already been required</p>

<p>考虑后觉得可能是 css 和 javascript 重复引入的造成的。即 .css.scss 不能 require 和 import 重复的 css</p>

<!--more-->


<p>如 app/assets/stylesheets/application.css.scss</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/*
</span><span class='line'> * This is a manifest file that'll automatically include all the stylesheets available in this directory
</span><span class='line'> * and any sub-directories. You're free to add application-wide styles to this file and they'll appear at
</span><span class='line'> * the top of the compiled file, but it's generally better to create a new file per style scope.
</span><span class='line'> *= require_self
</span><span class='line'> *= require_tree .
</span><span class='line'>*/
</span><span class='line'>
</span><span class='line'>// Example using 'Cerulean' bootswatch
</span><span class='line'>//
</span><span class='line'>// First import journal variables
</span><span class='line'>@import "bootswatch/cerulean/variables";
</span><span class='line'>
</span><span class='line'>// Then bootstrap itself
</span><span class='line'>@import "bootstrap";
</span><span class='line'>
</span><span class='line'>// Bootstrap body padding for fixed navbar
</span><span class='line'>//body { padding-top: 40px; }
</span><span class='line'>
</span><span class='line'>// Responsive styles go here in case you want them
</span><span class='line'>@import "bootstrap-responsive";
</span><span class='line'>
</span><span class='line'>// And finally bootswatch style itself
</span><span class='line'>@import "bootswatch/cerulean/bootswatch";
</span><span class='line'>
</span><span class='line'>// Whatever application styles you have go last
</span><span class='line'>@import "admin";</span></code></pre></td></tr></table></div></figure>


<p>修改为仅保留</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Example using 'Cerulean' bootswatch
</span><span class='line'>//
</span><span class='line'>// First import journal variables
</span><span class='line'>@import "bootswatch/cerulean/variables";
</span><span class='line'>
</span><span class='line'>// Then bootstrap itself
</span><span class='line'>@import "bootstrap";
</span><span class='line'>
</span><span class='line'>// Bootstrap body padding for fixed navbar
</span><span class='line'>//body { padding-top: 40px; }
</span><span class='line'>
</span><span class='line'>// Responsive styles go here in case you want them
</span><span class='line'>@import "bootstrap-responsive";
</span><span class='line'>
</span><span class='line'>// And finally bootswatch style itself
</span><span class='line'>@import "bootswatch/cerulean/bootswatch";
</span><span class='line'>
</span><span class='line'>// Whatever application styles you have go last
</span><span class='line'>@import "admin";</span></code></pre></td></tr></table></div></figure>


<p>同样.js 不能重复 require 相同的 js
如 app/assets/javascripts/application.js</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//This is a manifest file that'll be compiled into including all the files listed below.
</span><span class='line'>//Add new JavaScript/Coffee code in separate files in this directory and they'll automatically
</span><span class='line'>// be included in the compiled file accessible from http://example.com/assets/application.js
</span><span class='line'>//It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
</span><span class='line'>// the compiled file.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>//= require jquery
</span><span class='line'>//= require jquery_ujs
</span><span class='line'>
</span><span class='line'>//= require bootstraps</span></code></pre></td></tr></table></div></figure>


<p>改为仅保留</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// This is a manifest file that'll be compiled into including all the files listed below.
</span><span class='line'>// Add new JavaScript/Coffee code in separate files in this directory and they'll automatically
</span><span class='line'>// be included in the compiled file accessible from http://example.com/assets/application.js
</span><span class='line'>// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
</span><span class='line'>// the compiled file.
</span><span class='line'>//
</span><span class='line'>//= require jquery
</span><span class='line'>//= require jquery_ujs
</span><span class='line'>//= require_tree .</span></code></pre></td></tr></table></div></figure>


<p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[resolving error: env: ruby_noexec_wrapper: No such file or directory]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/09/12/resolving-error-env-ruby-noexec-wrapper-no-such-file-or-directory/"/>
    <updated>2012-09-12T23:42:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/09/12/resolving-error-env-ruby-noexec-wrapper-no-such-file-or-directory</id>
    <content type="html"><![CDATA[<p>通过 RVM 和 Gemset 新建 Rails 项目下运行 bundle 命令，不管是 bundle install or bundle ，都提示失败：</p>

<p>env: ruby_noexec_wrapper: No such file or directory</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:message blogbin$ bundle install
</span><span class='line'>env: ruby_noexec_wrapper: No such file or directory
</span><span class='line'>blogbins-MacBook-Pro:message blogbin$ gem list
</span><span class='line'>
</span><span class='line'>*** LOCAL GEMS ***
</span><span class='line'>
</span><span class='line'>bundler (1.0.22)
</span><span class='line'>rubygems-update (1.8.24)</span></code></pre></td></tr></table></div></figure>


<p>2012 年 9 月 15 日更新:
应该是 bundler 版本过低造成的，解决办法如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:omniauth-atyun-oauth2 blogbin$ gem install bundler
</span><span class='line'>Downloading http://rubygems.org/latest_specs.4.8.gz
</span><span class='line'>File already downloaded and cached to /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@omniauth-atyun-oauth2/cache
</span><span class='line'>Downloading http://rubygems.org/gems/bundler-1.1.4.gem
</span><span class='line'>######################################################################## 100.0%
</span><span class='line'>Successfully installed bundler-1.1.4
</span><span class='line'>1 gem installed
</span><span class='line'>Installing ri documentation for bundler-1.1.4...
</span><span class='line'>Installing RDoc documentation for bundler-1.1.4...</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:omniauth-atyun-oauth2 blogbin$ gem list
</span><span class='line'>
</span><span class='line'>*** LOCAL GEMS ***
</span><span class='line'>
</span><span class='line'>bundler (1.1.4, 1.0.22)
</span><span class='line'>gem-fast (0.0.6.3)
</span></code></pre></td></tr></table></div></figure>


<p>奇怪的是，之前的 bundler 1.0.22 没办法 uninstall，不过不影响 bundle 命令，暂不考虑解决它。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:omniauth-atyun-oauth2 blogbin$ gem uninstall bundler -v 1.0.22
</span><span class='line'>INFO:  gem "bundler" is not installed</span></code></pre></td></tr></table></div></figure>


<p>非常奇怪，后来考虑可能是 RubyGem 版本问题，尝试更新 RubyGem 的版本</p>

<!--more-->




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:message blogbin$ gem update --system
</span><span class='line'>Updating rubygems-update
</span><span class='line'>Fetching: rubygems-update-1.8.24.gem (100%)
</span><span class='line'>Successfully installed rubygems-update-1.8.24
</span><span class='line'>Installing RubyGems 1.8.24
</span><span class='line'>RubyGems 1.8.24 installed
</span><span class='line'>
</span><span class='line'>== 1.8.24 / 2012-04-27
</span><span class='line'>
</span><span class='line'>* 1 bug fix:
</span><span class='line'>
</span><span class='line'>  * Install the .pem files properly. Fixes #320
</span><span class='line'>  * Remove OpenSSL dependency from the http code path
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>------------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>RubyGems installed the following executables:
</span><span class='line'>     /Users/blogbin/.rvm/rubies/ruby-1.9.3-p0/bin/gem
</span><span class='line'>
</span><span class='line'>RubyGems system software updated</span></code></pre></td></tr></table></div></figure>


<p>重新运行 bundle 命令，均正常。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Upgrading to Rails 3.2.8]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/09/12/upgrading-to-rails-3-dot-2-8/"/>
    <updated>2012-09-12T23:23:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/09/12/upgrading-to-rails-3-dot-2-8</id>
    <content type="html"><![CDATA[<p>最近计划将 Rails 从 3.1.0 升级到 3.2.8 版本。</p>

<p>一是为解决 Rails 3.1.0 版本的 Security Issue，引入新功能；
二是为解决 Assets 相关的 Bugs，比如在 development 环境，scss 修改后无法动态编译，需要重启方能生效的问题；</p>

<!--more-->


<p>（ 2012 年 9 月 13 日更新）
如果使用 haml，需要升级 haml 版本至 3.1.4</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">case</span> <span class="no">RAILS_VERSION</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">when</span> <span class="no">RAILS_3_1_0</span>
</span><span class='line'>    <span class="n">gem</span> <span class="s2">&quot;haml&quot;</span><span class="p">,</span> <span class="s2">&quot;3.0.17&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">when</span> <span class="no">RAILS_3_2_8</span>
</span><span class='line'>    <span class="n">gem</span> <span class="s2">&quot;haml&quot;</span><span class="p">,</span> <span class="s2">&quot;3.1.4&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>否则启动 Rails 项目会出现 undefined method `delegate_template_exists?&#8217; 的错误</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Uncaught</span> <span class="n">exception</span><span class="p">:</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="sb">`delegate_template_exists?&#39; for class `</span><span class="no">ActionView</span><span class="o">::</span><span class="no">Base</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/haml-3.0.17/lib/haml/template/patch.rb:16:in `alias_method&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">haml</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">17</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haml</span><span class="o">/</span><span class="n">template</span><span class="o">/</span><span class="n">patch</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">16</span><span class="ss">:in</span> <span class="sb">`&lt;class:Base&gt;&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/haml-3.0.17/lib/haml/template/patch.rb:12:in `</span><span class="o">&lt;</span><span class="n">module</span><span class="ss">:ActionView</span><span class="o">&gt;</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/haml-3.0.17/lib/haml/template/patch.rb:11:in `&lt;top (required)&gt;&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activesupport</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">dependencies</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">251</span><span class="ss">:in</span> <span class="sb">`require&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/dependencies.rb:251:in `</span><span class="n">block</span> <span class="k">in</span> <span class="nb">require</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/dependencies.rb:236:in `load_dependency&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activesupport</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">dependencies</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">251</span><span class="ss">:in</span> <span class="sb">`require&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/haml-3.0.17/lib/haml/template.rb:60:in `</span><span class="o">&lt;</span><span class="n">top</span> <span class="p">(</span><span class="n">required</span><span class="p">)</span><span class="o">&gt;</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/dependencies.rb:251:in `require&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activesupport</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">dependencies</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">251</span><span class="ss">:in</span> <span class="sb">`block in require&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/dependencies.rb:236:in `</span><span class="n">load_dependency</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/dependencies.rb:251:in `require&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">haml</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">17</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haml</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">36</span><span class="ss">:in</span> <span class="sb">`block in init_rails&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/haml-3.0.17/lib/haml.rb:36:in `</span><span class="n">each</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/haml-3.0.17/lib/haml.rb:36:in `init_rails&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">haml</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">17</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haml</span><span class="o">/</span><span class="n">railtie</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">18</span><span class="ss">:in</span> <span class="sb">`block (2 levels) in &lt;top (required)&gt;&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/lazy_load_hooks.rb:36:in `</span><span class="nb">instance_eval</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/lazy_load_hooks.rb:36:in `execute_hook&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activesupport</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">lazy_load_hooks</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">26</span><span class="ss">:in</span> <span class="sb">`block in on_load&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/lazy_load_hooks.rb:25:in `</span><span class="n">each</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/lazy_load_hooks.rb:25:in `on_load&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">haml</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">17</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">haml</span><span class="o">/</span><span class="n">railtie</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">17</span><span class="ss">:in</span> <span class="sb">`block in &lt;top (required)&gt;&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/lazy_load_hooks.rb:36:in `</span><span class="nb">instance_eval</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/lazy_load_hooks.rb:36:in `execute_hook&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activesupport</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">lazy_load_hooks</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">43</span><span class="ss">:in</span> <span class="sb">`block in run_load_hooks&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/lazy_load_hooks.rb:42:in `</span><span class="n">each</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/lazy_load_hooks.rb:42:in `run_load_hooks&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">railties</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rails</span><span class="o">/</span><span class="n">application</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">69</span><span class="ss">:in</span> <span class="sb">`block in &lt;module:Bootstrap&gt;&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/railties-3.2.8/lib/rails/initializable.rb:30:in `</span><span class="n">instance_exec</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/railties-3.2.8/lib/rails/initializable.rb:30:in `run&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">railties</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rails</span><span class="o">/</span><span class="n">initializable</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">55</span><span class="ss">:in</span> <span class="sb">`block in run_initializers&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/railties-3.2.8/lib/rails/initializable.rb:54:in `</span><span class="n">each</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/railties-3.2.8/lib/rails/initializable.rb:54:in `run_initializers&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">railties</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rails</span><span class="o">/</span><span class="n">application</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">136</span><span class="ss">:in</span> <span class="sb">`initialize!&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/railties-3.2.8/lib/rails/railtie/configurable.rb:30:in `</span><span class="nb">method_missing</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/projects/workspaces/app_store/ruby/app_store/config/environment.rb:7:in `&lt;top (required)&gt;&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activesupport</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">dependencies</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">251</span><span class="ss">:in</span> <span class="sb">`require&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/dependencies.rb:251:in `</span><span class="n">block</span> <span class="k">in</span> <span class="nb">require</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/activesupport-3.2.8/lib/active_support/dependencies.rb:236:in `load_dependency&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">activesupport</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">dependencies</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">251</span><span class="ss">:in</span> <span class="sb">`require&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/projects/workspaces/app_store/ruby/app_store/config.ru:4:in `</span><span class="n">block</span> <span class="k">in</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">&gt;</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/rack-1.4.1/lib/rack/builder.rb:51:in `instance_eval&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">rack</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rack</span><span class="o">/</span><span class="n">builder</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">51</span><span class="ss">:in</span> <span class="sb">`initialize&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/projects/workspaces/app_store/ruby/app_store/config.ru:1:in `</span><span class="kp">new</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/projects/workspaces/app_store/ruby/app_store/config.ru:1:in `&lt;main&gt;&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">rack</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rack</span><span class="o">/</span><span class="n">builder</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">40</span><span class="ss">:in</span> <span class="sb">`eval&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/rack-1.4.1/lib/rack/builder.rb:40:in `</span><span class="n">parse_file</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/rack-1.4.1/lib/rack/server.rb:200:in `app&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">railties</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rails</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">46</span><span class="ss">:in</span> <span class="sb">`app&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/rack-1.4.1/lib/rack/server.rb:301:in `</span><span class="n">wrapped_app</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/rack-1.4.1/lib/rack/server.rb:252:in `start&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">railties</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rails</span><span class="o">/</span><span class="n">commands</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">70</span><span class="ss">:in</span> <span class="sb">`start&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/railties-3.2.8/lib/rails/commands.rb:55:in `</span><span class="n">block</span> <span class="k">in</span> <span class="o">&lt;</span><span class="n">top</span> <span class="p">(</span><span class="n">required</span><span class="p">)</span><span class="o">&gt;</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/.rvm/gems/ruby-1.9.3-p0@appstore/gems/railties-3.2.8/lib/rails/commands.rb:50:in `tap&#39;</span>
</span><span class='line'>     <span class="sr">/Users/</span><span class="n">blogbin</span><span class="o">/.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">p0</span><span class="vi">@appstore</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">railties</span><span class="o">-</span><span class="mi">3</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rails</span><span class="o">/</span><span class="n">commands</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">50</span><span class="ss">:in</span> <span class="sb">`&lt;top (required)&gt;&#39;</span>
</span><span class='line'><span class="sb">     /Users/blogbin/projects/workspaces/app_store/ruby/app_store/script/rails:6:in `</span><span class="nb">require</span><span class="s1">&#39;</span>
</span><span class='line'><span class="s1">     /Users/blogbin/projects/workspaces/app_store/ruby/app_store/script/rails:6:in `&lt;top (required)&gt;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Gemfile 除了将 Rails 版本修改为 3.2.8 之外，需要调整 group assets 中 sass-rails, coffee-rails 的版本依赖。</p>

<p>为避免 Rails 版本升级失败，方便回退版本，在 Gemfile 定义一些变量和判断条件来做检查，如：</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#rails</span>
</span><span class='line'><span class="c1"># rails version</span>
</span><span class='line'><span class="no">RAILS_3_2_8</span> <span class="o">=</span> <span class="s1">&#39;3.2.8&#39;</span>
</span><span class='line'><span class="no">RAILS_3_1_0</span> <span class="o">=</span> <span class="s1">&#39;3.1.0&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">RAILS_VERSION</span> <span class="o">=</span> <span class="no">RAILS_3_2_8</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="no">RAILS_VERSION</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">when</span> <span class="no">RAILS_3_1_0</span>
</span><span class='line'>    <span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.1.0&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">when</span> <span class="no">RAILS_3_2_8</span>
</span><span class='line'>    <span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.2.8&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="no">RAILS_VERSION</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">when</span> <span class="no">RAILS_3_1_0</span>
</span><span class='line'>      <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span> <span class="s2">&quot;  ~&gt; 3.1.0&quot;</span>
</span><span class='line'>      <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 3.1.0&quot;</span>
</span><span class='line'>      <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">when</span> <span class="no">RAILS_3_2_8</span>
</span><span class='line'>      <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;~&gt; 3.2.3&#39;</span>
</span><span class='line'>      <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.2.1&#39;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># See https://github.com/sstephenson/execjs#readme for more supported runtimes</span>
</span><span class='line'>      <span class="c1"># gem &#39;therubyracer&#39;, :platforms =&gt; :ruby</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.0.3&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行 bundle install 之前，需要先删除 Gemfile.lock，以防原来的版本依赖带来的干扰</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">blogbins</span><span class="o">-</span><span class="no">MacBook</span><span class="o">-</span><span class="no">Pro</span><span class="ss">:focus</span> <span class="n">blogbin</span><span class="err">$</span> <span class="n">rm</span> <span class="no">Gemfile</span><span class="o">.</span><span class="n">lock</span>
</span><span class='line'>
</span><span class='line'><span class="n">blogbins</span><span class="o">-</span><span class="no">MacBook</span><span class="o">-</span><span class="no">Pro</span><span class="ss">:focus</span> <span class="n">blogbin</span><span class="err">$</span> <span class="n">bundle</span> <span class="n">install</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Bootstrap and Bootswatch]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/09/09/using-bootstrap/"/>
    <updated>2012-09-09T01:01:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/09/09/using-bootstrap</id>
    <content type="html"><![CDATA[<p>Bootstrap 是 Twitter 开源免费提供的 CSS框架，它是快速开发Web应用程序的前端工具包。
它是一个CSS和HTML的集合，它使用了最新的浏览器技术，给Web开发提供了时尚的版式</p>

<p><a href="http://twitter.github.com/bootstrap/index.html">http://twitter.github.com/bootstrap/index.html</a></p>

<p><a href="https://github.com/twitter/bootstrap">https://github.com/twitter/bootstrap</a></p>

<p>中文翻译参见：
Twitter Bootstrap中文版/中文翻译
<a href="http://wrongwaycn.github.com/bootstrap/docs/index.html">http://wrongwaycn.github.com/bootstrap/docs/index.html</a></p>

<p>Bootstrap 默认只提供黑色和白色风格，也有一些付费的风格。如果想尝试免费的其它风格，可以试试看 Bootswatch
<a href="http://bootswatch.com/">http://bootswatch.com/</a></p>

<p><a href="https://github.com/maxim/bootswatch-rails">https://github.com/maxim/bootswatch-rails</a></p>

<p>Rails 项目引入 Bootstrap 和 Bootswatch 比较容易。</p>

<!--more-->


<p>修改 Gemfile</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;bootstrap-sass&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;bootswatch-rails&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>在 app/assets/stylesheets/application.css.scs 通过 @import 引入 bootstrap 和 bootswatch 的 css</p>

<figure class='code'><figcaption><span>app/assets/stylesheets/application.css.scss</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="o">//</span> <span class="nt">Example</span> <span class="nt">using</span> <span class="s1">&#39;Cerulean&#39;</span> <span class="nt">bootswatch</span>
</span><span class='line'><span class="o">//</span>
</span><span class='line'><span class="o">//</span> <span class="nt">First</span> <span class="nt">import</span> <span class="nt">journal</span> <span class="nt">variables</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;bootswatch/cerulean/variables&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="nt">Then</span> <span class="nt">bootstrap</span> <span class="nt">itself</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;bootstrap&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="nt">Bootstrap</span> <span class="nt">body</span> <span class="nt">padding</span> <span class="nt">for</span> <span class="nt">fixed</span> <span class="nt">navbar</span>
</span><span class='line'><span class="o">//</span><span class="nt">body</span> <span class="p">{</span> <span class="k">padding-top</span><span class="o">:</span> <span class="m">40px</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="nt">Responsive</span> <span class="nt">styles</span> <span class="nt">go</span> <span class="nt">here</span> <span class="nt">in</span> <span class="nt">case</span> <span class="nt">you</span> <span class="nt">want</span> <span class="nt">them</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;bootstrap-responsive&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="nt">And</span> <span class="nt">finally</span> <span class="nt">bootswatch</span> <span class="nt">style</span> <span class="nt">itself</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;bootswatch/cerulean/bootswatch&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">//</span> <span class="nt">Whatever</span> <span class="nt">application</span> <span class="nt">styles</span> <span class="nt">you</span> <span class="nt">have</span> <span class="nt">go</span> <span class="nt">last</span>
</span><span class='line'><span class="k">@import</span> <span class="s2">&quot;video_recommendation_types&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bootstrap 有些交互控件（如 Dropdown）需要一些 javascript，建议部署在 vertor/assets/javascripts目录</p>

<figure class='code'><figcaption><span>app/assets/stylesheets/application.css.scss</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">blogbins-MacBook-Pro</span><span class="nd">:focus</span> <span class="nt">blogbin</span><span class="err">$</span> <span class="nt">find</span> <span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">/</span>
</span><span class='line'><span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">/</span>
</span><span class='line'><span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">//</span><span class="nt">javascripts</span>
</span><span class='line'><span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">//</span><span class="nt">javascripts</span><span class="o">/</span><span class="nt">bootstraps</span>
</span><span class='line'><span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">//</span><span class="nt">javascripts</span><span class="o">/</span><span class="nt">bootstraps</span><span class="o">/</span><span class="nt">bootstrap-collapse</span><span class="nc">.js</span>
</span><span class='line'><span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">//</span><span class="nt">javascripts</span><span class="o">/</span><span class="nt">bootstraps</span><span class="o">/</span><span class="nt">bootstrap-dropdown</span><span class="nc">.js</span>
</span><span class='line'><span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">//</span><span class="nt">javascripts</span><span class="o">/</span><span class="nt">bootstraps</span><span class="o">/</span><span class="nt">index</span><span class="nc">.js</span>
</span><span class='line'><span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">//</span><span class="nt">stylesheets</span>
</span><span class='line'><span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">//</span><span class="nt">stylesheets</span><span class="o">/</span><span class="nc">.gitkeep</span>
</span></code></pre></td></tr></table></div></figure>


<p>建议在该目录下创建 manifest 清单文件，引用其它 javascript 文件</p>

<figure class='code'><figcaption><span>app/assets/stylesheets/application.css.scss</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">blogbins-MacBook-Pro</span><span class="nd">:focus</span> <span class="nt">blogbin</span><span class="err">$</span> <span class="nt">cat</span> <span class="nt">vendor</span><span class="o">/</span><span class="nt">assets</span><span class="o">//</span><span class="nt">javascripts</span><span class="o">/</span><span class="nt">bootstraps</span><span class="o">/</span><span class="nt">index</span><span class="nc">.js</span>
</span><span class='line'><span class="o">//=</span> <span class="nt">require_tree</span> <span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="nt">blogbins-MacBook-Pro</span><span class="nd">:focus</span> <span class="nt">blogbin</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>在 app/assets/javascripts/application.js 引入需要的 javascript</p>

<figure class='code'><figcaption><span>app/assets/javascripts/application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//This is a manifest file that&#39;ll be compiled into including all the files listed below.</span>
</span><span class='line'><span class="c1">//Add new JavaScript/Coffee code in separate files in this directory and they&#39;ll automatically</span>
</span><span class='line'><span class="c1">// be included in the compiled file accessible from http://example.com/assets/application.js</span>
</span><span class='line'><span class="c1">//It&#39;s not advisable to add code directly here, but if you do, it&#39;ll appear at the bottom of the</span>
</span><span class='line'><span class="c1">// the compiled file.</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//= require jquery</span>
</span><span class='line'><span class="c1">//= require jquery_ujs</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//= require bootstraps</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 可以继续需要引入其它 javascript 文件或清单文件</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后运行 bundle install 安装／更新 gems 之前，需要先删除 Gemfile.lock，以防原来的版本依赖带来的干扰</p>

<figure class='code'><figcaption><span>app/assets/javascripts/application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">blogbins</span><span class="o">-</span><span class="nx">MacBook</span><span class="o">-</span><span class="nx">Pro</span><span class="o">:</span><span class="nx">focus</span> <span class="nx">blogbin$</span> <span class="nx">rm</span> <span class="nx">Gemfile</span><span class="p">.</span><span class="nx">lock</span>
</span><span class='line'>
</span><span class='line'><span class="nx">blogbins</span><span class="o">-</span><span class="nx">MacBook</span><span class="o">-</span><span class="nx">Pro</span><span class="o">:</span><span class="nx">focus</span> <span class="nx">blogbin$</span> <span class="nx">bundle</span> <span class="nx">install</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using Bitbucket]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/31/using-bitbucket/"/>
    <updated>2012-08-31T22:41:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/31/using-bitbucket</id>
    <content type="html"><![CDATA[<p>Bitbucket <a href="https://bitbucket.org/">https://bitbucket.org/</a>
是免费存放私人 Git 仓库的一个 GitHub 之外很好的选择。不限空间，不限项目。即使免费，也可以创建多个团队协助开发，
限制是每个团队人数不能超过 5 人。</p>

<p>是我提交／备份非公开项目的好地方。</p>

<p>Tech-blog 这个 Octopress 博客，已经部署／提交在多个 SaaS，故写一个 shell 脚本减轻工作量：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#! /bin/bash
</span><span class='line'>git push
</span><span class='line'>
</span><span class='line'>git push local master
</span><span class='line'>
</span><span class='line'>git push heroku master
</span><span class='line'>
</span><span class='line'>git push bitbucket master
</span><span class='line'>
</span><span class='line'>rake deploy</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[installing-gitlab-on-ubuntu-server-12-04-amd64]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/31/installing-gitlab-on-ubuntu-server-12-04-amd64/"/>
    <updated>2012-08-31T19:54:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/31/installing-gitlab-on-ubuntu-server-12-04-amd64</id>
    <content type="html"><![CDATA[<p>Gitlab 是开源免费的 Git 仓库管理系统，可以作为 GitHub 本地小型的简化版本。</p>

<p>支持 Web 化管理 Git 项目，管理用户和 SSH-KEY，提供对 Git 项目的文件浏览，提交浏览，文件比较和代码评审，
并提供一定程度的 Wiki 和 Issue 问题跟踪功能。</p>

<p>感觉 Git 管理功能比 Gitosis 要强，但问题跟踪要比 Redmine 要弱；</p>

<p>没有组织结构或者团队等企业架构管理，偏适用小型项目团队。</p>

<p>在 Ubuntu Server 上安装还算简单，官网 Wiki 有详细的安装指南。</p>

<p>但我却走了不少弯路，先总结如下：</p>

<ol>
<li><p>要选择 Ubuntu Server 来安装 Gitlab，而不是选择用 Ubuntu Desktop，否则可能会出现一堆依赖相关的错误；</p></li>
<li><p>不要用快捷命令一下子跳过前三步，可能因为网络问题，有些依赖包不能正常下载和安装，建议老老实实从 1. Install packages 开始安装</p></li>
</ol>


<blockquote><p>First 3 steps can be easily skipped with simply install script:</p><p># Install curl and sudo <br/>apt-get install curl sudo</p><p># 3 steps in 1 command :)<br/>curl https://raw.github.com/gitlabhq/gitlabhq/master/doc/debian_ubuntu.sh | sh<br/>Now you can go to step 4&#8221;</p><p>1. Install packages<br/>Keep in mind that sudo is not installed for debian by default. You should install it with as root: apt-get update && apt-get upgrade && apt-get install sudo</p></blockquote>


<h5>参阅</h5>

<p>GITLAB: Self Hosted Git Management Application</p>

<p><a href="http://gitlabhq.com/">http://gitlabhq.com/</a></p>

<p>gitlabhq/gitlabhq</p>

<p><a href="https://github.com/gitlabhq/gitlabhq">https://github.com/gitlabhq/gitlabhq</a></p>

<p>gitlabhq/doc/installation.md at stable · gitlabhq/gitlabhq</p>

<p><a href="https://github.com/gitlabhq/gitlabhq/blob/stable/doc/installation.md">https://github.com/gitlabhq/gitlabhq/blob/stable/doc/installation.md</a></p>

<!--more-->


<h5>配置 Ubuntu 防火墙策略</h5>

<p>Gitlab 官网假定已经开放防火墙 22, 80, 3000 端口，以及安装并启动 sshd 服务，否则需要手动开放端口和启动 sshd 服务。</p>

<p>一直用 MacOS X + CentOS 惯了，对 Ubuntu 倒变的不熟悉了。</p>

<p>参阅
IptablesHowTo - Ubuntu中文</p>

<p><a href="http://wiki.ubuntu.org.cn/IptablesHowTo">http://wiki.ubuntu.org.cn/IptablesHowTo</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sudo iptables -L
</span><span class='line'>
</span><span class='line'>查看现有的iptables防火墙规则。如果您刚架设好服务器，那么规则表应该是空的，您将看到如下内容
</span><span class='line'>Chain INPUT (policy ACCEPT)
</span><span class='line'>target     prot opt source               destination
</span><span class='line'>Chain FORWARD (policy ACCEPT)
</span><span class='line'>target     prot opt source               destination
</span><span class='line'>Chain OUTPUT (policy ACCEPT) 
</span><span class='line'>target     prot opt source               destination
</span><span class='line'>
</span><span class='line'>http://wiki.ubuntu.org.cn/IptablesHowTo
</span><span class='line'>
</span><span class='line'># iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
</span><span class='line'>
</span><span class='line'># iptables -A INPUT -p tcp -i eth0 --dport ssh -j ACCEPT
</span><span class='line'>#或者
</span><span class='line'># iptables -A INPUT -p tcp -i eth0 --dport 22 -j ACCEPT
</span><span class='line'>
</span><span class='line'># iptables -L
</span><span class='line'>Chain INPUT (policy ACCEPT)
</span><span class='line'>target     prot opt source               destination
</span><span class='line'>ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED 
</span><span class='line'>ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:ssh</span></code></pre></td></tr></table></div></figure>


<p>开放 3000 和 80 端口</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># iptables -A INPUT -p tcp -i eth0 --dport 3000 -j ACCEPT
</span><span class='line'># iptables -A INPUT -p tcp -i eth0 --dport 80 -j ACCEPT</span></code></pre></td></tr></table></div></figure>


<p>支持开机重新设置防火墙</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>atyun@ubuntu:/home/gitlab/gitlab$ sudo iptables-save &gt; /etc/iptables.up.rules
</span><span class='line'>-bash: /etc/iptables.up.rules: Permission denied
</span><span class='line'>atyun@ubuntu:/home/gitlab/gitlab$ sudo su root
</span><span class='line'>
</span><span class='line'>root@ubuntu:/home/gitlab/gitlab# iptables-save &gt; /etc/iptables.up.rules
</span><span class='line'>
</span><span class='line'>root@ubuntu:/home/gitlab/gitlab# /etc/init.d/ssh restart
</span><span class='line'>Rather than invoking init scripts through /etc/init.d, use the service(8)
</span><span class='line'>utility, e.g. service ssh restart
</span><span class='line'>
</span><span class='line'>Since the script you are attempting to invoke has been converted to an
</span><span class='line'>Upstart job, you may also use the stop(8) and then start(8) utilities,
</span><span class='line'>e.g. stop ssh ; start ssh. The restart(8) utility is also available.
</span><span class='line'>ssh stop/waiting
</span><span class='line'>ssh start/running, process 9672
</span><span class='line'>
</span><span class='line'>#sudo vi /etc/network/interfaces
</span><span class='line'># This file describes the network interfaces available on your system
</span><span class='line'># and how to activate them. For more information, see interfaces(5).
</span><span class='line'>
</span><span class='line'># The loopback network interface
</span><span class='line'>auto lo
</span><span class='line'>iface lo inet loopback
</span><span class='line'>
</span><span class='line'># The primary network interface
</span><span class='line'>auto eth0
</span><span class='line'>iface eth0 inet dhcp
</span><span class='line'>
</span><span class='line'>pre-up iptables-restore &lt; /etc/iptables.up.rules</span></code></pre></td></tr></table></div></figure>


<p>安装 sshd 服务</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install openssh-server</span></code></pre></td></tr></table></div></figure>


<p>安装其它 Gem 之前，先安装 gem-fast 会提高后续安装 gem 速度</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>atyun@ubuntu:/home/git$ sudo gem install gem-fast
</span><span class='line'>
</span><span class='line'>========================================================================
</span><span class='line'>
</span><span class='line'>  Thanks for installing Gem-Fast!
</span><span class='line'>  Gem-Fast will use curl to make your gem install faster!
</span><span class='line'>
</span><span class='line'>  Try it now use:  gem install rails   
</span><span class='line'>
</span><span class='line'>========================================================================
</span><span class='line'>
</span><span class='line'>Successfully installed gem-fast-0.0.6.3
</span><span class='line'>1 gem installed
</span><span class='line'>Installing ri documentation for gem-fast-0.0.6.3...
</span><span class='line'>Installing RDoc documentation for gem-fast-0.0.6.3...</span></code></pre></td></tr></table></div></figure>


<p>运行 bundle install 可能会出现安装 rake 失败，需要升级 gem 至最新版本</p>

<blockquote><p>Install gems</p><p>sudo -u gitlab -H bundle install &#8211;without development test &#8211;deployment</p></blockquote>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Warning: /home/gitlab/.gem/ruby/1.9.1/cache/rake-0.9.2.2.gem: No such file or
</span><span class='line'>Warning: directory
</span><span class='line'>                                                                           0.8%
</span><span class='line'>curl: (23) Failed writing body (0 != 892)
</span><span class='line'>
</span><span class='line'>GemFast::Util::ExecutionError: Failure while executing: curl -f#LA rubygem-gemfast http://rubygems.org/gems/rake-0.9.2.2.gem --insecure -o /home/gitlab/.gem/ruby/1.9.1/cache/rake-0.9.2.2.gem
</span><span class='line'>An error occured while installing rake (0.9.2.2), and Bundler cannot continue.
</span><span class='line'>Make sure that `gem install rake -v '0.9.2.2'` succeeds before bundling.
</span><span class='line'>
</span><span class='line'>[1]+  Exit 5                  sudo -u gitlab -H bundle install --without development test --deployment
</span><span class='line'>atyun@ubuntu:/home/gitlab/gitlab$ sudo -u gitlab -H bundle install --without development test --deployment
</span><span class='line'>Fetching gem metadata from http://rubygems.org/.^C
</span><span class='line'>Quitting…</span></code></pre></td></tr></table></div></figure>


<p>注意安装 gem 需要 sudo</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>atyun@ubuntu:/home/gitlab/gitlab$ sudo gem update --system
</span><span class='line'>Updating RubyGems
</span><span class='line'>Downloading http://rubygems.org/latest_specs.4.8.gz
</span><span class='line'>File already downloaded and cached to /usr/local/lib/ruby/gems/1.9.1/cache
</span><span class='line'>Updating rubygems-update
</span><span class='line'>Downloading http://rubygems.org/quick/Marshal.4.8/rubygems-update-1.8.24.gemspec.rz
</span><span class='line'>######################################################################## 100.0%
</span><span class='line'>Downloading http://rubygems.org/gems/rubygems-update-1.8.24.gem
</span><span class='line'>######################################################################## 100.0%
</span><span class='line'>Successfully installed rubygems-update-1.8.24
</span><span class='line'>Updating RubyGems to 1.8.24
</span><span class='line'>Installing RubyGems 1.8.24
</span><span class='line'>RubyGems 1.8.24 installed
</span><span class='line'>
</span><span class='line'>== 1.8.24 / 2012-04-27
</span><span class='line'>
</span><span class='line'>* 1 bug fix:
</span><span class='line'>
</span><span class='line'>  * Install the .pem files properly. Fixes #320
</span><span class='line'>  * Remove OpenSSL dependency from the http code path
</span><span class='line'>
</span><span class='line'>------------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>RubyGems installed the following executables:
</span><span class='line'>     /usr/local/bin/gem</span></code></pre></td></tr></table></div></figure>


<p>重新安装 rake</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>atyun@ubuntu:/home/gitlab/gitlab$ gem install rake -v '0.9.2.2'
</span><span class='line'>Downloading http://rubygems.org/specs.4.8.gz
</span><span class='line'>^CERROR:  Interrupted
</span><span class='line'>atyun@ubuntu:/home/gitlab/gitlab$ sudo !!
</span><span class='line'>sudo gem install rake -v '0.9.2.2'
</span><span class='line'>Downloading http://rubygems.org/specs.4.8.gz
</span><span class='line'>######################################################################## 100.0%
</span><span class='line'>Downloading http://rubygems.org/quick/Marshal.4.8/rake-0.9.2.2.gemspec.rz
</span><span class='line'>######################################################################## 100.0%
</span><span class='line'>Downloading http://rubygems.org/gems/rake-0.9.2.2.gem
</span><span class='line'>######################################################################## 100.0%
</span><span class='line'>Successfully installed rake-0.9.2.2
</span><span class='line'>1 gem installed
</span><span class='line'>Installing ri documentation for rake-0.9.2.2...
</span><span class='line'>Installing RDoc documentation for rake-0.9.2.2…</span></code></pre></td></tr></table></div></figure>


<p>命令运行结果经常出现 Setting locale failed，估计和本地 locale 设置有关。但不影响其它操作，暂不理他。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>perl: warning: Setting locale failed.
</span><span class='line'>perl: warning: Please check that your locale settings:
</span><span class='line'>     LANGUAGE = "en_US:",
</span><span class='line'>     LC_ALL = (unset),
</span><span class='line'>     LC_CTYPE = "UTF-8",
</span><span class='line'>     LANG = "en_US.UTF-8"
</span><span class='line'>    are supported and installed on your system.
</span><span class='line'>perl: warning: Falling back to the standard locale ("C").</span></code></pre></td></tr></table></div></figure>


<h5>Gitlab 显示效果如下图：</h5>

<blockquote><p><img src="http://tech-blog.blogbin.info/images/2012-08-31-installing-gitlab-on-ubuntu-server-12-04-amd64/starting.jpeg"></p><p><img src="http://tech-blog.blogbin.info/images/2012-08-31-installing-gitlab-on-ubuntu-server-12-04-amd64/project.jpeg"></p></blockquote>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Monitoring rails app with the New Relic]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/29/monitoring-rails-app-with-the-new-relic/"/>
    <updated>2012-08-29T22:01:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/29/monitoring-rails-app-with-the-new-relic</id>
    <content type="html"><![CDATA[<p>尝试 New Relic 监控 Rails App 项目的运行情况。</p>

<p>如果采用 Rails 3，安装 New Relic 非常简单，如果使用 Rails 2，比较繁琐一些。
好在官方网站有相应的介绍，仔细阅读即可。</p>

<!--more-->


<h5>参阅</h5>

<p>Ruby Agent installation - New Relic Documentation</p>

<p><a href="https://newrelic.com/docs/ruby/ruby-agent-installation">https://newrelic.com/docs/ruby/ruby-agent-installation</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Installing the Gem
</span><span class='line'>We recommend installing the New Relic Ruby gem in order to have better control over versions and dependencies. However, the gem is not supported for Rails versions prior to 2.0. If you're using Rails 1.2.6 and earlier, install the plugin.
</span><span class='line'>
</span><span class='line'>Our gem is available on rubygems.org as newrelic_rpm:
</span><span class='line'>
</span><span class='line'> sudo gem install newrelic_rpm
</span><span class='line'>For Rails 3 and installations using Bundler, simply add our gem to the Gemfile:
</span><span class='line'>
</span><span class='line'>gem 'newrelic_rpm'
</span><span class='line'>For Rails versions 2.1 to 2.3 without Bundler, edit environment.rb and add to the initializer block:
</span><span class='line'>
</span><span class='line'>config.gem "newrelic_rpm" 
</span><span class='line'>For Rails versions 2.0.*, edit environment.rb and add this statement after the initializer block:
</span><span class='line'>
</span><span class='line'>require "newrelic_rpm"</span></code></pre></td></tr></table></div></figure>


<p>Ruby Agent installation - plugin - New Relic Documentation</p>

<p><a href="https://newrelic.com/docs/ruby/ruby-agent-installation-plugin">https://newrelic.com/docs/ruby/ruby-agent-installation-plugin</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Installing the Plugin
</span><span class='line'>Note that we strongly encourage using the gem.
</span><span class='line'>The plugin should be installed from Github using the following commands.
</span><span class='line'>
</span><span class='line'>For Rails versions 2.*:
</span><span class='line'>
</span><span class='line'>ruby script/plugin install git://github.com/newrelic/rpm.git
</span><span class='line'>mv vendor/plugins/rpm vendor/plugins/newrelic_rpm
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>This will export the plugin into your application's vendor/plugins directory.
</span><span class='line'>
</span><span class='line'>If you can't install the plugin directly from the git URL, you can clone the repository into the vendor/plugins directory.</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;m using Unicorn and I don&#8217;t see any data - New Relic Documentation</p>

<p><a href="https://newrelic.com/docs/troubleshooting/im-using-unicorn-and-i-dont-see-any-data">https://newrelic.com/docs/troubleshooting/im-using-unicorn-and-i-dont-see-any-data</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>I'm using Unicorn and I don't see any data
</span><span class='line'>
</span><span class='line'>If you're using Unicorn with the agent, you should be using the preload_app truedirective in your Unicorn configuration or the agent may not finish starting up. (see http://unicorn.bogomips.org/Unicorn/Configurator.html#method-i-preload_app)
</span><span class='line'>
</span><span class='line'>If you don't want to use preload_app true, you can manually call our handler for forking web servers from an initializer file in config/initializers:
</span><span class='line'>
</span><span class='line'># Ensure the agent is started using Unicorn
</span><span class='line'># This is needed when using Unicorn and preload_app is not set to true.
</span><span class='line'># See http://support.newrelic.com/kb/troubleshooting/unicorn-no-data  
</span><span class='line'>::NewRelic::Agent.after_fork(:force_reconnect =&gt; true) if defined? Unicorn</span></code></pre></td></tr></table></div></figure>


<p></p>

<h5>监控效果如下图：</h5>

<blockquote><p><img src="http://tech-blog.blogbin.info/images/2012-08-29-monitoring-rails-app-with-the-new-relic/rails_app.jpeg"></p></blockquote>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Securing CentOS Server with firewall]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/28/securing-centos-server-with-firewall/"/>
    <updated>2012-08-28T21:37:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/28/securing-centos-server-with-firewall</id>
    <content type="html"><![CDATA[<p>对 CentOS 敏感端口如 SSH, FTP 等服务端口做限制来源 IP 地址的限制，每一个端口防火墙配置都要指定来源 IP 地址比较烦；
把一堆端口混在一条配置规则也不太利于维护。</p>

<p>为了避免每条过滤规则都要重复指定客户端 IP 地址，采用加入一个新链。</p>

<h5>参阅</h5>

<p>Iptables 指南 1.1.19</p>

<p><a href="http://www.frozentux.net/iptables-tutorial/cn/iptables-tutorial-cn-1.1.19.html#PREPARATIONS">http://www.frozentux.net/iptables-tutorial/cn/iptables-tutorial-cn-1.1.19.html#PREPARATIONS</a></p>

<p>42.8. Firewalls</p>

<p><a href="http://www.centos.org/docs/5/html/Deployment_Guide-en-US/ch-fw.html#s1-basic-firewall">http://www.centos.org/docs/5/html/Deployment_Guide-en-US/ch-fw.html#s1-basic-firewall</a></p>

<p>42.9. IPTables</p>

<p><a href="http://www.centos.org/docs/5/html/Deployment_Guide-en-US/ch-iptables.html#s2-iptables-init-conf">http://www.centos.org/docs/5/html/Deployment_Guide-en-US/ch-iptables.html#s2-iptables-init-conf</a></p>

<!--more-->


<h5>修改 /etc/sysconfig/iptables</h5>

<p>修改 /etc/sysconfig/iptables 配置文件，并重启 iptables 服务
a. 增加一个新链，专门处理访问敏感服务端口的数据包
b. 在新链中，只接受受信任客户端 IP 地址的网络包
c. 在新链中，其它其它客户端 IP 地址（如公司外网 IP 地址，其它服务器地址等）网络包被拒绝
d. 访问敏感服务端口的网络包转为新创建的链来处理（处理方式为接受 -j ACCEPT ）</p>

<h5>注意事项：</h5>

<p>a. 修改重启 iptables 服务之前，本地多开几个SSH会话预先登陆服务器，以免 iptables 重启后，由于配置不当，造成服务器无法访问</p>

<h5>配置举例：</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[atyun@ays3 ~]$ sudo vi /etc/sysconfig/iptables
</span><span class='line'>
</span><span class='line'># Firewall configuration written by system-config-firewall
</span><span class='line'># Manual customization of this file is not recommended.
</span><span class='line'>*filter
</span><span class='line'>:INPUT ACCEPT [0:0]
</span><span class='line'>:FORWARD ACCEPT [0:0]
</span><span class='line'>:OUTPUT ACCEPT [0:0]
</span><span class='line'>
</span><span class='line'># a. 创建一个新链，专门处理访问敏感服务端口的数据包
</span><span class='line'>#input_intranet
</span><span class='line'>-N input_intranet
</span><span class='line'>
</span><span class='line'># b. 在新链中，只接受受信任客户端 IP 地址的网络包
</span><span class='line'>-A input_intranet -s 192.168.1.100 -j ACCEPT
</span><span class='line'># c. 在新链中，其它客户端 IP 地址网络包被拒绝
</span><span class='line'>-A input_intranet -j REJECT --reject-with icmp-host-prohibited
</span><span class='line'>
</span><span class='line'>-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
</span><span class='line'>-A INPUT -p icmp -j ACCEPT
</span><span class='line'>-A INPUT -i lo -j ACCEPT
</span><span class='line'>
</span><span class='line'># WEB 服务 90端口 不做限制
</span><span class='line'>-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
</span><span class='line'>
</span><span class='line'># d. 访问敏感服务端口的网络包转为新创建的链来处理
</span><span class='line'>-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j input_intranet
</span><span class='line'>-A INPUT -j REJECT --reject-with icmp-host-prohibited
</span><span class='line'>-A FORWARD -j REJECT --reject-with icmp-host-prohibited
</span><span class='line'>COMMIT</span></code></pre></td></tr></table></div></figure>


<p>省去重启 iptabes 等操作。。。</p>

<h5>检查 iptables 服务状况</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[atyun@ays3 ~]$ sudo iptables -L -n -x -v
</span><span class='line'>Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
</span><span class='line'>    pkts      bytes target     prot opt in     out     source               destination        
</span><span class='line'>  402937 476407720 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
</span><span class='line'>       5      265 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0          
</span><span class='line'>       0        0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0          
</span><span class='line'>       0        0 input_intranet  tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           state NEW tcp dpt:2144
</span><span class='line'>      10      600 input_intranet  tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           state NEW tcp dpt:22
</span><span class='line'>      16    19200 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited
</span><span class='line'>
</span><span class='line'>Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)
</span><span class='line'>    pkts      bytes target     prot opt in     out     source               destination        
</span><span class='line'>       0        0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited
</span><span class='line'>
</span><span class='line'>Chain OUTPUT (policy ACCEPT 252777 packets, 13740803 bytes)
</span><span class='line'>    pkts      bytes target     prot opt in     out     source               destination        
</span><span class='line'>
</span><span class='line'>Chain input_intranet (2 references)
</span><span class='line'>    pkts      bytes target     prot opt in     out     source               destination        
</span><span class='line'>       1       60 ACCEPT     all  --  *      *       192.168.1.111        0.0.0.0/0          
</span><span class='line'>       9      540 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-host-prohibited </span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Installing BigBlueButton]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/27/installing-bigbluebutton/"/>
    <updated>2012-08-27T20:56:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/27/installing-bigbluebutton</id>
    <content type="html"><![CDATA[<p>一直使用开源免费的 BigBlueButton 作为 Web 多人会议，文档分享讨论和桌面分享的系统。</p>

<p>BigBlueButton &#8211; Open Source Web Conferencing | www.bigbluebutton.org
<a href="http://www.bigbluebutton.org/">http://www.bigbluebutton.org/</a></p>

<p>发现 7 月份，BigBlueButton 提供基于 0.8x 的 VM 虚拟机。这比之前使用 0.7x VM 虚拟机，手动升级到 0.8 很方便。
安装过程参阅：</p>

<p><a href="http://code.google.com/p/bigbluebutton/wiki/BigBlueButtonVM">http://code.google.com/p/bigbluebutton/wiki/BigBlueButtonVM</a></p>

<p>这次安装遇到 FAQ 提到的问题，VM 虚拟机启动之后，没有正常链接到网络，没有自动安装 BigBlueButton。还好官方 FAQ 提供手动安装 BigBlueButton 的办法。</p>

<!--more-->




<blockquote><p>bbb-conf command not found<br/>When it first launches, if the BigBlueButton VM is unable to connect to the internet it will not finish the installation. You&#8217;ll see this when yo typebbb-conf command and receive the error &#8220;command not found&#8221;.<br/>The solution is to make sure the VM can connect with the internet. You should be able to<br/>   ping ubuntu.bigbluebutton.organd get a response. Once connected, do the following commands:<br/>   <br/>   sudo apt-get update</p><p>   sudo apt-get dist-upgrade</p><p>Then you can finish the installation manually by following these steps.</p><p>      sudo apt-get install bigbluebutton</p><p>       sudo apt-get install bbb-demo</p><p>        sudo bbb-conf &#8211;clean</p><p>        sudo bbb-conf &#8211;check</p><p>        sudo bbb-conf &#8211;setip <ip/hostname]]&gt;</p></blockquote>


<h5>配置 BigBlueButton</h5>

<p>可能会遇到的问题是</p>

<ol>
<li>需要开放三个防火墙端口，</li>
<li>运行 sudo bbb-conf &#8211;setip 设置 ip 地址或者域名</li>
</ol>


<p>以上问题，官方 FAQ 有详细的解决办法，必须仔细阅读。</p>

<ol>
<li>共享 word 等文档中文乱码问题
具体参阅：
BigBlueButton中乱码问题的解决 | 武汉周杰
<a href="http://www.zhojie.cn/?p=308">http://www.zhojie.cn/?p=308</a></li>
</ol>


<blockquote><p>乱码 问题的源头是由于Ubuntu系统缺少对于的中文字库TTF文件<br/>解决步骤如下：<br/>1）复制Win系统中文字体到Ubuntu系统中（Win系统字体存放路径为C:\Windows\Fonts，Ubuntu系统中字体存放路径为/usr/share/fonts）<br/>2）在Ubuntu系统字库库中创建一个目录，将Win系统中中文字体拷贝进去<br/>sudo cd /usr/share/fonts<br/>sudo mkdir myfonts<br/>sudo chmod 755 myfonts<br/>cp /win/*.ttf /usr/shar/fonts/myfonts<br/>3）建立字体缓存<br/>sudo mkfontscale<br/>sudo mkfontdir<br/>sudo fc-cache –fv<br/>4）重启Ubuntu系统<br/>/sbin/shutdown -r now<br/>注：如果不重启，将不会生效！</p></blockquote>


<h5>问题</h5>

<ol>
<li>一直采用 VM 虚拟机安装 BigBlueButton 0.7x，之后手动升级到 0.8x 的方式。
BigBlueButton 安装配置之后，一般能够稳定运行一段时间。很蹊跷的是，如果某天由于某种原因，比如关机，强制关闭，断电等等，
BigBlueButton 的 VM 虚拟机重新启动，会提示 Error: FreeSwitch fail&#8230;。</li>
</ol>


<p>即使不停重启系统，甚至用之前 VM 虚拟机的备份或者 clone 版本，重新启动虚拟机，也是类似的问题。</p>

<p>当然也有解决的办法，就是重新安装 BigBlueButton VM 虚拟机。</p>

<h5>一些希望</h5>

<ol>
<li><p>BigBlueButton 安全认证：BigBlueButton 自带一个简单的 WebDemo，可以创建 Web 会议，但无法控制谁能够或者不能够参加会议。
完整的权限需要自己二次开发实现</p></li>
<li><p>文档共享窗口比较小，无法充分使用更多屏幕空间，共享桌面的窗口更小，希望后续版本有改进。</p></li>
<li><p>比较容易基于 Ubuton 安装 BigBlueButton，CentOS 安装 BigBlueButton 比较费劲。</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using tokkonopapa's octopress-tagcloud]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/26/using-tokkonopapas-octopress-tagcloud/"/>
    <updated>2012-08-26T23:39:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/26/using-tokkonopapas-octopress-tagcloud</id>
    <content type="html"><![CDATA[<h5>参阅</h5>

<p>tokkonopapa/octopress-tagcloud · GitHub
<a href="https://github.com/tokkonopapa/octopress-tagcloud">https://github.com/tokkonopapa/octopress-tagcloud</a></p>

<h5>导航栏添加 Categories 和 Tags 链接</h5>

<p>修改 source/_includes/custom/navigation.html 添加 Categories 和 Tags 链接：</p>

<figure class='code'><figcaption><span>source/_includes/custom/navigation.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;main-navigation&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>Blog<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/categories&quot;</span><span class="nt">&gt;</span>Categories<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/tags&quot;</span><span class="nt">&gt;</span>Tags<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>  <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/blog/archives&quot;</span><span class="nt">&gt;</span>Archives<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'><span class="nt">&lt;/ul&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行 rake page 创建 source/categores 和 source/tags 目录和 html 文件：</p>

<figure class='code'><figcaption><span>source/_includes/custom/navigation.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ rake new_page[&quot;categories&quot;]
</span></code></pre></td></tr></table></div></figure>


<p>source/categories/index.markdown 内容为：</p>

<figure class='code'><figcaption><span> (index.html)</span> <a href='http://tech-blog.blogbin.info/downloads/code/octopress/categories/index.html'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>---
</span><span class='line'>layout: page
</span><span class='line'>title: &quot;category_list&quot;
</span><span class='line'>date: 2012-08-23 00:01
</span><span class='line'>comments: true
</span><span class='line'>sharing: true
</span><span class='line'>footer: true
</span><span class='line'>---
</span><span class='line'>
</span><span class='line'>{% category_list counter:true %}
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>source/_includes/custom/navigation.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ rake new_page[&quot;tags&quot;]
</span></code></pre></td></tr></table></div></figure>


<p>source/tags/index.markdown 内容为：</p>

<figure class='code'><figcaption><span> (index.html)</span> <a href='http://tech-blog.blogbin.info/downloads/code/octopress/tags/index.html'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>---
</span><span class='line'>layout: page
</span><span class='line'>title: &quot;tags&quot;
</span><span class='line'>date: 2012-08-23 00:10
</span><span class='line'>comments: true
</span><span class='line'>sharing: true
</span><span class='line'>footer: true
</span><span class='line'>---
</span><span class='line'>
</span><span class='line'>{% tag_cloud %}
</span></code></pre></td></tr></table></div></figure>




<!--more-->


<h5>相关效果如下图：</h5>

<blockquote><p><img src="http://tech-blog.blogbin.info/images/2012-08-26-using-tokkonopapas-octopress-tagcloud/header.jpeg"><br/><img src="http://tech-blog.blogbin.info/images/2012-08-26-using-tokkonopapas-octopress-tagcloud/categories.jpeg"><br/><img src="http://tech-blog.blogbin.info/images/2012-08-26-using-tokkonopapas-octopress-tagcloud/tags.jpeg"></p></blockquote>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using jcftang's octopress-relatedposts]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/25/using-jcftangs-octopress-relatedposts/"/>
    <updated>2012-08-25T08:33:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/25/using-jcftangs-octopress-relatedposts</id>
    <content type="html"><![CDATA[<p>参阅 jcftang/octopress-relatedposts <a href="https://github.com/jcftang/octopress-relatedposts">https://github.com/jcftang/octopress-relatedposts</a></p>

<p>其实 Octopress 已经内置了 LSI 引擎，安装和配置 octopress-relatedposts 比较简单。</p>

<blockquote><p>Firstly add this to your _config.yml file</p><p>lsi: true<br/>The create a file such as source/_includes/custom/asides/related.html with the following content</p><p>&#8230;.</p><p>It is possible to style the list, but in the above I have chosen to keep the same style as the recent posts.</p><p>Finally, add the file to your default asides list in your _config.yml file</p><p>default_asides: [custom/asides/related.html, &#8230;]</p></blockquote>




<!--more-->


<p>相关帖子效果如下图：</p>

<blockquote><p><img src="http://tech-blog.blogbin.info/images/2012-08-25-using-jcftangs-octopress-relatedposts/octopress-relatedposts.jpeg"></p></blockquote>


<p>引入   source/_includes/custom/asides/related.html
比较遗憾的时，启用 LSI 后，运行 rake generate 的时间延长了 10 倍左右。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Using neerajcse's octopress-calendar-aside]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/25/using-neerajcses-octopress-calendar-aside/"/>
    <updated>2012-08-25T03:50:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/25/using-neerajcses-octopress-calendar-aside</id>
    <content type="html"><![CDATA[<p>Octopress 提供按日历归类显示文章的第三方插件。</p>

<p>参阅
neerajcse/octopress-calendar-aside · GitHub
<a href="https://github.com/neerajcse/octopress-calendar-aside">https://github.com/neerajcse/octopress-calendar-aside</a></p>

<p>按照官方文档安装和配置 octopress-calendar-aside，插件的效果显示出来了，不过有一些小遗憾。</p>

<!--more-->




<blockquote><p>All you need to do is:</p><p>add the file calendar.html to the default asides location. (.themes/classic/source/_includes/asides)<br/>add the file calendar.js to the default javascript location. (.themes/classic/source/javascript)<br/>add the calendar aside to _config.yml file. (see the config.yml in commited source)<br/>add the images prev.png and next.png to .themes/classic/source/images/. (these images are free for non-commercial purposes)</p></blockquote>


<p>官方建议将代码部署在 .themes 目录下会出现问题。访问首页或具体一篇文章时，右侧 calendar-aside 位置报错：</p>

<p>找不到 _includes/asides/calendar.html</p>

<p>我改为相关文件部署在 source 子目录，而非 .themes，重新编译后显示正常。</p>

<p>日历显示效果如下图：</p>

<blockquote><p><img src="http://tech-blog.blogbin.info/images/2012-08-25-using-neerajcses-octopress-calendar-aside/calendar-aside.jpg"></p></blockquote>


<h3>遗留问题</h3>

<p>不知道是不是我自身环境的问题，遗留了两个问题：</p>

<ol>
<li>首页右侧 aside 无法看到日历，如访问: http://tech-blog.blogbin.info。</li>
</ol>


<p>必须访问具体一篇文章右侧 aside 才能看到日历，如 http://tech-blog.blogbin.info/blog/2012/08/22/using-binarylogic-slash-settingslogic/。</p>

<ol>
<li>_config.yml 中 asides/calendar.html 必须放在 aside 的最下边位置，否则会造成 aside 余下的其它<section>无法显示</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#_config.yml
</span><span class='line'>default_asides: [ custom/asides/about.html, asides/recent_posts.html, asides/github.html,  asides/delicious.html, asides/pinboard.html, asides/googleplus.html, asides/calendar.html ]</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[installing iftop on CentOS 6]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/24/installing-iftop-on-centos-6/"/>
    <updated>2012-08-24T22:55:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/24/installing-iftop-on-centos-6</id>
    <content type="html"><![CDATA[<p>使用 iftop 简单监控服务器网络流量。安装过程如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@hj01 ~]# yum install -y wget
</span><span class='line'>
</span><span class='line'>[root@hj01 ~]# wget http://www.ex-parrot.com/~pdw/iftop/download/iftop-0.17.tar.gz
</span><span class='line'>
</span><span class='line'>[root@hj01 ~]# tar -xvf iftop-0.17
</span><span class='line'>
</span><span class='line'>[root@hj01 ~]# yum install -y flex byacc  libpcap　libpcap-devel ncurses ncurses-devel
</span><span class='line'>
</span><span class='line'>[root@hj01 ~]# yum install -y libpcap-devel
</span><span class='line'>
</span><span class='line'>[root@hj01 ~]# cd iftop-0.17
</span><span class='line'>
</span><span class='line'>[root@hj01 iftop-0.17]# ./configure
</span><span class='line'>
</span><span class='line'>[root@hj01 iftop-0.17]# make
</span><span class='line'>
</span><span class='line'>[root@hj01 iftop-0.17]# make install
</span><span class='line'>
</span><span class='line'>[root@hj01 iftop-0.17]# iftop</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>运行 sudo iftop 可能会出现 iftop: command not found 的情况，如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[atyun@localhost iftop-0.17]$ sudo iftop
</span><span class='line'>
</span><span class='line'>sudo: iftop: command not found</span></code></pre></td></tr></table></div></figure>


<p>明确写出 iftop 命令的完整路径，如</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[atyun@localhost iftop-0.17]$ sudo /usr/local/sbin/iftop</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[用 git-flow 进行分支操作]]></title>
    <link href="http://tech-blog.blogbin.info/blog/2012/08/23/using-git-flow/"/>
    <updated>2012-08-23T22:28:00+08:00</updated>
    <id>http://tech-blog.blogbin.info/blog/2012/08/23/using-git-flow</id>
    <content type="html"><![CDATA[<p>参阅：</p>

<p>nvie/gitflow
<a href="https://github.com/nvie/gitflow/">https://github.com/nvie/gitflow/</a></p>

<p>A successful Git branching model » nvie.com
<a href="http://nvie.com/posts/a-successful-git-branching-model/">http://nvie.com/posts/a-successful-git-branching-model/</a></p>

<p>或者中文版</p>

<p>Git开发管理之道 - 无网不剩
<a href="http://blog.leezhong.com/translate/2010/10/30/a-successful-git-branch.html">http://blog.leezhong.com/translate/2010/10/30/a-successful-git-branch.html</a></p>

<p>其实 git-flow 只是对 git 分支 checkout, 创建, merge 等命令进行包装，采用推荐的命令方式来使用优秀的分支创建和合并实践策略，
避免代码改动提交混乱，对本地仓库管理的代码几乎没有影响。</p>

<p>首先要明白 master 为产品分支，develop 为开发分支。
如果你以前采用 master 为主线或开发分支，产品分支为其他分支，脑筋要转过来。</p>

<!--more-->


<h5>2012/9/19 更新：</h5>

<p>安装 git flow
<a href="https://github.com/nvie/gitflow/wiki/Installation">https://github.com/nvie/gitflow/wiki/Installation</a></p>

<p>git flow 初始化本地仓库</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ git flow init
</span><span class='line'>
</span><span class='line'>Which branch should be used for bringing forth production releases?
</span><span class='line'>   - master
</span><span class='line'>Branch name for production releases: [master]
</span><span class='line'>Branch name for "next release" development: [develop]
</span><span class='line'>
</span><span class='line'>How to name your supporting branch prefixes?
</span><span class='line'>Feature branches? [feature/]
</span><span class='line'>Release branches? [release/]
</span><span class='line'>Hotfix branches? [hotfix/]
</span><span class='line'>Support branches? [support/]
</span><span class='line'>Version tag prefix? [] TEBN
</span><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ git status
</span><span class='line'># On branch develop
</span><span class='line'>nothing to commit (working directory clean)</span></code></pre></td></tr></table></div></figure>


<p>开始一个特性(octopress-indexer)开发</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ git flow feature start octopress-indexer
</span><span class='line'>Switched to a new branch 'feature/octopress-indexer'
</span><span class='line'>
</span><span class='line'>Summary of actions:
</span><span class='line'>- A new branch 'feature/octopress-indexer' was created, based on 'develop'
</span><span class='line'>- You are now on branch 'feature/octopress-indexer'
</span><span class='line'>
</span><span class='line'>Now, start committing on your feature. When done, use:
</span><span class='line'>
</span><span class='line'>     git flow feature finish octopress-indexer</span></code></pre></td></tr></table></div></figure>


<p>结束一个特性开发</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ git flow feature finish octopress-indexer
</span><span class='line'>Switched to branch 'develop'
</span><span class='line'>Updating 024efad..6a21c04
</span><span class='line'>Fast-forward
</span><span class='line'> plugins/indexer.rb                          |  255 +++++++++++++++++++++++++++
</span><span class='line'> source/_includes/custom/asides/indexer.html |   10 ++
</span><span class='line'> 2 files changed, 265 insertions(+)
</span><span class='line'> create mode 100644 plugins/indexer.rb
</span><span class='line'> create mode 100644 source/_includes/custom/asides/indexer.html
</span><span class='line'>Deleted branch feature/octopress-indexer (was 6a21c04).
</span><span class='line'>
</span><span class='line'>Summary of actions:
</span><span class='line'>- The feature branch 'feature/octopress-indexer' was merged into 'develop'
</span><span class='line'>- Feature branch 'feature/octopress-indexer' has been removed
</span><span class='line'>- You are now on branch 'develop'</span></code></pre></td></tr></table></div></figure>


<p>手动将 develop 开发分支的改动 merge 回 master 产品分支</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ git checkout master
</span><span class='line'>Switched to branch 'master'
</span><span class='line'>
</span><span class='line'># 建议使用 --no-ff 选项，让 merge 也成为一个 commitment.
</span><span class='line'>blogbins-MacBook-Pro:octopress blogbin$ git merge --no-ff develop
</span><span class='line'>Merge made by the 'recursive' strategy.
</span><span class='line'> plugins/indexer.rb                          |  255 +++++++++++++++++++++++++++
</span><span class='line'> source/_includes/custom/asides/indexer.html |   10 ++
</span><span class='line'> 2 files changed, 265 insertions(+)
</span><span class='line'> create mode 100644 plugins/indexer.rb
</span><span class='line'> create mode 100644 source/_includes/custom/asides/indexer.html</span></code></pre></td></tr></table></div></figure>


<p>以上 git-flow 命令执行过程其实是对以下 git 命令的包装：</p>

<p>先基于 master 产品分支创建并切换到 develop 开发分支</p>

<p>git checkout -b develop master</p>

<p>开始开发一个新特性，基于 develop 创建新特性分支</p>

<p>git checkout -b feature/fengbin/using-git-flow develop</p>

<p>修改文件，提交文件。。。</p>

<p>切换回 develop 开发分支，将 using-git-flow 特性分支改动 merge 到 develop 开发分支</p>

<p>git checkout develop</p>

<p>git merge &#8211;no-ff feature/fengbin/using-git-flow</p>

<p>最后删除 using-git-flow 特性分支</p>

<p>git checkout -d feature/fengbin/using-git-flow develop</p>

<p>已有项目中初始化 git-flow 可能会出现以下错误：</p>

<p>Local branch &#8216;xxx&#8217; does not exist.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:app_store blogbin$ git flow init
</span><span class='line'>
</span><span class='line'>Which branch should be used for bringing forth production releases?
</span><span class='line'>   - features/favorite
</span><span class='line'>   - master
</span><span class='line'>Branch name for production releases: [master] develop
</span><span class='line'>Local branch 'develop' does not exist.</span></code></pre></td></tr></table></div></figure>


<p>查阅 git-flow 官方教程或者网络资料，不管是已有项目或者新项目，初始化 git-flow 都是相同的命令 git flow init。</p>

<p>怀疑可能是本地仓库之前已经运行过 git flow init，随后有不按 git-flow 模式创建分支所致。</p>

<h5>2012 年 8 月 27 日更新</h5>

<p>解决办法为以下任选：</p>

<ol>
<li><p>重现 git clone 远端仓库克隆出一个本地仓库，在本地仓库重新运行 git flow init。</p></li>
<li><p>手动创建 develop 开发分支，然后重新运行 git flow init</p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>blogbins-MacBook-Pro:atyun-focus-video blogbin$ git checkout -b develop master
</span><span class='line'>Switched to a new branch 'develop'
</span><span class='line'>blogbins-MacBook-Pro:atyun-focus-video blogbin$ git checkout master
</span><span class='line'>Switched to branch 'master'
</span><span class='line'>blogbins-MacBook-Pro:atyun-focus-video blogbin$ git flow init</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
